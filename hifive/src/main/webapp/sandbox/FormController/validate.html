<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- jquery -->
<!--[if lt IE 9]>
		<script src="/hifive-res/ext/jquery/jquery-1.js"></script>
		<![endif]-->
<!--[if gte IE 9]><!-->
<script src="/hifive-res/ext/jquery/jquery-2.js"></script>
<!--<![endif]-->

<!-- bootstrap -->
<link href="/hifive-res/ext/bootstrap/3.3.4/css/bootstrap.min.css"
	rel="stylesheet" media="screen">
<script src="/hifive-res/ext/bootstrap/3.3.4/js/bootstrap.min.js"></script>

<!-- hifive -->
<!-- <link href="/hifive-res/fw/current/h5.css" rel="stylesheet"> -->
<script src="/hifive-res/fw/current/ejs-h5mod.js"></script>
<!-- <script src="/hifive-res/fw/current/h5.dev.js"></script> -->
<!-- h5ソースファイルの読み込み -->
<script>
	H5_TEST_ENV = window.H5_TEST_ENV || {};
	H5_TEST_ENV.buildType = 'src';
	H5_TEST_ENV.srcBaseUrl = '../../';
</script>
<script src="../../test/loadScriptForTest.js"></script>

<script src="../../src/h5.ui.FormController.js"></script>
<style>
.errorMsg {
	font-weight: bold;
	color: #f00;
}
</style>
<script>
	$(function() {
		h5.core.controller(document.body, {
			__name: 'sample.PageController',
			_objIndex: 0,
			__meta: {
				formController: {
					rootElement: '#form1'
				}
			},
			formController: h5.ui.FormController,
			__init: function() {
				// フォーム全体のエラーの出力設定
				var globalOut = {
					/* 出力先 */
					container: this.$find('.globalError'),
					/* 各エラーメッセージをラップする要素 */
					wrapper: 'li'
				};
				this.formController.setGlobalOutput(globalOut);

				// 各フォーム部品ごとのエラーの出力設定
				var outputConfig = {}
				this.$find('#form1 [name]').each(this.ownWithOrg(function(element) {
					outputConfig[element.name] = {
						onError: this._onError,
						label: $(element).closest('.form-group').find('.label-name').text()
					}
				}));

				this.formController.setOutputConfig(outputConfig);

				// エラーメッセージテンプレートの設定(正規表現のメッセージをデフォルトのものを上書き)
				this.formController.invalidMessageView.register('pattern', '[%=label%]が正しくありません');
			},
			'.gather click': function(ctx, $el) {
				var ret = this.formController.gather();
				var $set = $('<button class="set">set(obj' + ++this._objIndex + ')</button>');
				$el.after($set);
				$set.data('obj', ret);
			},
			'.set click': function(ctx, $el) {
				var obj = $el.data('obj');
				this.formController.set(obj);
			},
			'.validate click': function(ctx) {
				this._removeValidateError();
				var result = this.formController.validate();
				this.$find('.validateResult').html(QUnit.jsDump.parse(result));
			},
			'.clear click': function(ctx) {
				ctx.event.preventDefault();
				this.formController.clear();
			},
			'#form1 [submit]': function() {
				this._removeValidateError();
			},
			_removeValidateError: function() {
				this.$find('.has-error').removeClass('has-error');
				this.$find('.errorMsg').remove();
			},
			_onError: function(element, property, reason) {
				var $targetGroup = $(element).closest('.form-group');
				$targetGroup.addClass('has-error');
				var $msg = $('<span class="errorMsg"></span>');
				var msgTxt = reason.message;
				if (element.name === 'agree') {
					// 『同意する』のチェックボックスならメッセージを書き換える
					msgTxt = 'サービスのご利用は、利用規約の同意が必要です';
				}
				$msg.text(reason.message);
				$targetGroup.append($msg);
			}
		});
	});
</script>

<title>フォームのvalidateサンプル</title>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<ul class="globalError"></ul>
				<form class="form" id="form1">
					<div class="form-group">
						<label class="control-label"><span class="label-name">名前</span>(必須)</label>
						<input name="name" type="text" class="form-control"
							placeholder="名前" data-require />
					</div>
					<div class="form-group">
						<label class="control-label"><span class="label-name">性別</span>
							<div class="radio">
								<label> <input name="sex" type="radio" name="radio"
									data-require /> 男性
								</label> <label> <input name="sex" type="radio" name="radio"
									data-require /> 女性
								</label>
							</div>
					</div>
					<div class="form-group">
						<label class="control-label"><span class="label-name">メールアドレス</span>(必須)</label>
						<input name="email" type="text" placeholder="example@example.com"
							class="form-control" data-require data-pattern=".+@.+" />
					</div>
					<div class="form-group">
						<label class="control-label"><span class="label-name">パスワード</span>(8文字以上16文字以下)</label>
						<input name="pass" type="password" class="form-control"
							placeholder="Password" data-require data-size="[8,16]" />
					</div>
					<div class="form-group">
						<label class="control-label"><span class="label-name">一言コメント</span>(10字以内)</label>
						<textarea name="comment" class="form-control" placeholder="一言コメント"
							data-size="[0,10]"></textarea>
					</div>
					<!-- select -->
					<div class="form-group">
						<label class="control-label"><span class="label-name">お住まい</span></label>
						<select name="address" class="form-control" data-require>
							<option value="">[必ず選択してください]</option>
							<option value="1">東京(23区内)</option>
							<option value="2">東京(23区外)</option>
							<option value="3">日本(東京外)</option>
							<option value="3">海外</option>
						</select>
					</div>
					<div class="form-group">
						<label class="control-label"><span class="label-name">希望パート</span>(3つまで選択可)</label>
						<select name="part" class="form-control" multiple data-require
							data-size="[1,3]">
							<option value="1">ギター</option>
							<option value="2">ベース</option>
							<option value="3">ドラム</option>
							<option value="4">ボーカル</option>
							<option value="5">ドラム</option>
							<option value="6">バイオリン</option>
							<option value="7">アゴゴベル</option>
						</select>
					</div>
					<div class="form-group">
						<label class="control-label"><span class="label-name">予約日</span>(翌日以降)</label>
						<input name="reserve" type="date" class="form-control"
							data-require data-future />
					</div>
					<div class="form-group">
						<label class="control-label"><span class="label-name">ご利用人数</span>(1～6)</label>
						<input name="member" type="number" class="form-control"
							data-require data-min="[1,true]" data-max="[6,true]" />
					</div>
					<div class="form-group">
						<label class="control-label" data-require data-future><span
							class="label-name">前回ご利用日</span>(今日以前)</label> <input name="last-date"
							type="date" class="form-control" data-past />
					</div>
					<div class="form-group">
						<div class="checkbox">
							<label> <input name="agree" type="checkbox" data-require /><span
								class="label-name">同意</span>する
							</label>
						</div>
					</div>
					<div class="form-group">
						<input class="btn btn-primary" type="submit" value="送信">
					</div>
				</form>
			</div>
		</div>
	</div>
</body>
</html>